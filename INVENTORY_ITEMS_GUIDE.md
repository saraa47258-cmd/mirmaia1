# دليل صفحة مواد المخزون وربط المنتجات

## التصميم والأداء والاستخدام

---

## ١. التصميم (احترافي وجميل)

- **الهيدر:** عنوان واضح مع وصف مختصر يوضح أن الصفحة لإدارة المواد الخام والربط مع المنتجات والخصم التلقائي.
- **التبويبات:** ثلاث تبويبات (مواد المخزون | ربط المنتجات | سجل الخصم التلقائي) بتصميم حديث مع تمييز التبويب النشط.
- **البطاقات (Cards):** كل قسم داخل بطاقة بخلفية بيضاء وظل خفيف وحواف مستديرة لتنظيم المحتوى.
- **النماذج:** حقول منظمة مع تسميات، تركيز واضح، وأزرار أساسية وثانوية وخطر (حذف) بلون مميز.
- **الجداول:** نفس أسلوب الجداول الحديثة في النظام مع شارات للكمية (أخضر طبيعي، أحمر منخفض).
- **الحالة الفارغة:** رسالة مع أيقونة عندما لا توجد مواد أو ربطات أو حركات، لتحسين وضوح الاستخدام.

---

## ٢. الأداء (Performance)

- **تحميل البيانات:** عند فتح الصفحة يتم جلب أربعة مصادر مرة واحدة:
  - قائمة المواد الخام (`GET /api/inventory-items`)
  - قائمة المنتجات (`GET /api/products`)
  - قائمة الربطات (`GET /api/product-inventory-usage`)
  - سجل الخصم (`GET /api/inventory-items/deduction-log`)
- **بعد كل إجراء:** يتم إعادة جلب البيانات المتأثرة فقط (مثلاً بعد إضافة مادة: إعادة جلب المواد الخام فقط، أو بعد الربط: إعادة جلب الربطات).
- **لا يوجد تخزين مؤقت إضافي:** البيانات دائماً محدثة مع الخادم؛ مناسب لبيانات المخزون الحساسة للوقت.
- **الواجهة:** التبويبات لا تعيد تحميل الصفحة؛ التحويل بينها فوري. الجداول والنماذج خفيفة ولا تؤثر على الأداء في الاستخدام العادي.

---

## ٣. الاستخدام (كيف تستخدم الصفحة)

### التبويب الأول: مواد المخزون

1. **إضافة مادة خام**
   - املأ: اسم المادة (مثل: كوب ورقي صغير)، الكمية، تكلفة الوحدة (اختياري)، الحد الأدنى.
   - اضغط **إضافة** لحفظ المادة.
2. **قائمة المواد الخام**
   - تعرض كل المواد مع الكمية، تكلفة الوحدة، والحد الأدنى.
   - الكمية تظهر كشارة: أخضر إذا كانت فوق الحد الأدنى، أحمر إذا كانت أقل أو تساويه.
3. **تعديل الكمية**
   - اضغط **تعديل الكمية** بجانب المادة، أدخل رقماً موجباً (+) لزيادة أو سالباً (-) لخصم، ثم **تطبيق**.
4. **حذف مادة**
   - اضغط **حذف** (يُفضّل أن لا تكون المادة مربوطة بمنتجات؛ وإلا قد تحتاج لإزالة الربط أولاً حسب إعدادات النظام).

### التبويب الثاني: ربط المنتجات

1. **إنشاء ربط**
   - اختر **المنتج** (من منتجات المنيو).
   - اختر **المادة الخام** (من قائمة المواد التي أضفتها).
   - حدد **الكمية لكل طلب** (مثلاً 1 = كوب واحد لكل طلب شاي صغير).
   - اضغط **ربط**.
2. **الربطات الحالية**
   - جدول يعرض: المنتج، المادة، الكمية لكل طلب، ورصيد المادة الحالي.
   - **إزالة الربط:** لإلغاء الربط بين منتج ومادة اضغط **إزالة الربط**.

### التبويب الثالث: سجل الخصم التلقائي

- يعرض كل حركة خصم تمت تلقائياً عند إنشاء طلب: الوقت، رقم الطلب، المنتج، المادة المخصومة، الكمية، وسعر البيع.
- مفيد للمراجعة والتدقيق ولمعرفة من أين خُصم المخزون.

---

## ٤. ملخص سريع

| المطلوب | أين تفعله |
|--------|-----------|
| إضافة مادة خام (أكواب، أوراق، إلخ) | مواد المخزون → النموذج → إضافة |
| ربط منتج مونيو بمادة (مثلاً شاي صغير = 1 كوب) | ربط المنتجات → اختيار المنتج والمادة والكمية → ربط |
| تعديل رصيد مادة يدوياً | مواد المخزون → تعديل الكمية → +/- ثم تطبيق |
| مراجعة من خُصم ومتى | سجل الخصم التلقائي |

الخصم من المخزون يحدث **تلقائياً** عند إتمام الطلب من الكاشير؛ لا تحتاج لخصم يدوي عند كل طلب. إذا كان الرصيد غير كافٍ، النظام يرفض الطلب ويُظهر رسالة توضح المادة والنقص.
